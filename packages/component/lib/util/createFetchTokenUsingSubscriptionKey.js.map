{"version":3,"sources":["../../src/util/createFetchTokenUsingSubscriptionKey.js"],"names":["TOKEN_EXPIRATION","TOKEN_EARLY_RENEWAL","lastRenew","accessTokenPromise","console","warn","now","Date","subscriptionKey","catch","reject","err"],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA;AACA;AACA,IAAMA,mBAAmB,MAAzB;AACA,IAAMC,sBAAsB,KAA5B;;kBAEe,2BAAmB;AAChC,MAAIC,YAAY,CAAhB;AACA,MAAIC,qBAAqB,IAAzB;;AAEA,SAAO,YAAM;AACX,QAAI,CAACD,SAAL,EAAgB;AACdE,cAAQC,IAAR,CAAa,2HAAb;AACD;;AAED,QAAMC,MAAMC,KAAKD,GAAL,EAAZ;;AAEA,QAAI,CAACH,kBAAD,IAAuBG,MAAMJ,SAAN,GAAkBF,mBAAmBC,mBAAhE,EAAqF;AACnFC,kBAAYI,GAAZ;;AAEAH,2BAAqB,6BAAcK,eAAd,EAA+BC,KAA/B,CAAqC,eAAO;AAC/D;AACAP,oBAAY,CAAZ;;AAEA,eAAO,kBAAQQ,MAAR,CAAeC,GAAf,CAAP;AACD,OALoB,CAArB;AAMD;;AAED,WAAOR,kBAAP;AACD,GAnBD;AAoBD,C","file":"createFetchTokenUsingSubscriptionKey.js","sourcesContent":["import exchangeToken from './exchangeToken';\n\n// Token expiration is hardcoded at 10 minutes\n// https://docs.microsoft.com/en-us/azure/cognitive-services/Speech/how-to/how-to-authentication?tabs=Powershell#use-an-authorization-token\nconst TOKEN_EXPIRATION = 600000;\nconst TOKEN_EARLY_RENEWAL = 60000;\n\nexport default subscriptionKey => {\n  let lastRenew = 0;\n  let accessTokenPromise = null;\n\n  return () => {\n    if (!lastRenew) {\n      console.warn('Subscription key token exchange is not recommended for production code. It will leak your subscription key to the client.');\n    }\n\n    const now = Date.now();\n\n    if (!accessTokenPromise || now - lastRenew > TOKEN_EXPIRATION - TOKEN_EARLY_RENEWAL) {\n      lastRenew = now;\n\n      accessTokenPromise = exchangeToken(subscriptionKey).catch(err => {\n        // Force to renew on next fetch\n        lastRenew = 0;\n\n        return Promise.reject(err);\n      });\n    }\n\n    return accessTokenPromise;\n  }\n}\n"]}