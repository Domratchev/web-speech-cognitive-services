{"version":3,"sources":["../../src/util/createFetchTokenUsingSubscriptionKey.js"],"names":["TOKEN_EXPIRATION","TOKEN_EARLY_RENEWAL","subscriptionKey","region","tokenUrl","lastRenew","accessTokenPromise","console","warn","now","Date","catch","err","Promise","reject"],"mappings":";;;;;;;;;AAAA;;AAEA;AACA;AACA,IAAMA,gBAAgB,GAAG,MAAzB;AACA,IAAMC,mBAAmB,GAAG,KAA5B;;eAEe,kBAACC,eAAD,EAAkBC,MAAlB,EAA0BC,QAA1B,EAAuC;AACpD,MAAIC,SAAS,GAAG,CAAhB;AACA,MAAIC,kBAAkB,GAAG,IAAzB;AAEA,SAAO,YAAM;AACX,QAAI,CAACF,QAAD,IAAa,CAACC,SAAlB,EAA6B;AAC3BE,MAAAA,OAAO,CAACC,IAAR,CAAa,2HAAb;AACD;;AAED,QAAMC,GAAG,GAAGC,IAAI,CAACD,GAAL,EAAZ;;AAEA,QAAI,CAACH,kBAAD,IAAuBG,GAAG,GAAGJ,SAAN,GAAkBL,gBAAgB,GAAGC,mBAAhE,EAAqF;AACnFI,MAAAA,SAAS,GAAGI,GAAZ;AAEAH,MAAAA,kBAAkB,GAAG,4BAAcJ,eAAd,EAA+BC,MAA/B,EAAuCC,QAAvC,EAAiDO,KAAjD,CAAuD,UAAAC,GAAG,EAAI;AACjF;AACAP,QAAAA,SAAS,GAAG,CAAZ;AAEA,eAAOQ,OAAO,CAACC,MAAR,CAAeF,GAAf,CAAP;AACD,OALoB,CAArB;AAMD;;AAED,WAAON,kBAAP;AACD,GAnBD;AAoBD,C","sourcesContent":["import exchangeToken from './exchangeToken';\n\n// Token expiration is hardcoded at 10 minutes\n// https://docs.microsoft.com/en-us/azure/cognitive-services/speech-service/rest-apis#authentication\nconst TOKEN_EXPIRATION = 600000;\nconst TOKEN_EARLY_RENEWAL = 60000;\n\nexport default (subscriptionKey, region, tokenUrl) => {\n  let lastRenew = 0;\n  let accessTokenPromise = null;\n\n  return () => {\n    if (!tokenUrl && !lastRenew) {\n      console.warn('Subscription key token exchange is not recommended for production code. It will leak your subscription key to the client.');\n    }\n\n    const now = Date.now();\n\n    if (!accessTokenPromise || now - lastRenew > TOKEN_EXPIRATION - TOKEN_EARLY_RENEWAL) {\n      lastRenew = now;\n\n      accessTokenPromise = exchangeToken(subscriptionKey, region, tokenUrl).catch(err => {\n        // Force to renew on next fetch\n        lastRenew = 0;\n\n        return Promise.reject(err);\n      });\n    }\n\n    return accessTokenPromise;\n  }\n}\n"],"file":"createFetchTokenUsingSubscriptionKey.js"}